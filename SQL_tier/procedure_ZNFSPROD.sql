CREATE PROCEDURE ZNFSPROD @V_DATADE VARCHAR(8) = NULL, @V_DATAATE VARCHAR(8) = NULL
AS
    
DECLARE @V_OBJ INT;
DECLARE @V_URL VARCHAR(200);
DECLARE @V_RESPONSE VARCHAR(8000);
  
SET @V_URL = 'http://10.150.0.12:8080/conector_smart/services/conn_nfsproduto?method=runJob&arg1=--context_param datade=' + @V_DATADE + '&arg2=--context_param dataate=' + @V_DATAATE
EXEC SP_OACREATE 'MSXML2.ServerXMLHttp', @V_OBJ out
EXEC SP_OAMETHOD @V_OBJ, 'OPEN', NULL, 'GET', @V_URL, FALSE
EXEC SP_OAMETHOD @V_OBJ, 'SEND'
exec SP_OAGETPROPERTY @V_OBJ, 'responseText', @V_RESPONSE out
  
select
FACODIGOEMPRESA,
FAEMITENTE,
FAMODELODOCUMENTO,
FATIPODOCUMENTO,
FASERIEDOCUMENTO,
FANUMERODOCUMENTO,
FANFECHAVE,
CONVERT(VARCHAR(10), FADATAEMISSAO, 112) FADATAEMISSAO,
CONVERT(VARCHAR(10), FADATASAIDA, 112) FADATASAIDA,
FAHORASAIDA,
FACODIGOCLIENTE,
FAUFCLIENTE,
FASITUACAODOC,
FAINDCANCELAMENTO,
FACONSUMIDOR,
FACONTRIBUINTE,
FAVALORPRODUTOS,
FATIPOFATURA,
FATOTALNFISCAL,
FABASEICMS,
FATOTALICM,
FABASEREDUCAOIPI,
FAVALORTOTALIPI,
FATOTALBASESUBST,
FATOTALICMSUBST,
FAINSCRICAOSUBSTITUTO,
FAVALORFRETE,
FAVALORSEGURO,
FAVALOROUTRAS,
FAVIATRANSPORTE,
FAMODALIDADEFRETE,
FACODIGOTRANSPORTADOR,
FAQTDEVOLUMES,
FAESPECIEVOLUMES,
FAMARCAVOLUMES,
FANUMERACAOVOLUMES,
FAPESOBRUTO,
FAPESOLIQUIDO,
FAIDENTIFICACAOVEICULO,
FATIPONOTA,
ITNUMEROITEM,
ITCODIGOPRODUTO,
ITCFOP,
ITCLASSIFICACAOFISCAL,
ITSITTRIBUTARIAFEDERAL,
ITQTDEPRODUTO,
ITUNIDADEMEDIDA,
ITVALORPRECOUNITARIO,
ITVALORPRECOTOTAL,
ITVALORDESCONTO,
ITDESPESASFRETE,
ITDESPESASSEGURO,
ITOUTRASDESPESAS,
ITINDMOVIMENTACAO,
ITVALORBASEICMS,
ITALIQUOTAICMS,
ITVALORICMS,
ITVALORISENTOICM,
ITVALOROUTROICM,
ITVALORCONTABILICM,
FABASEPIS,
ITBASEPIS,
ITALIQUOTAPIS,
ITVALORPIS,
FABASECOFINS,
ITBASECOFINS,
ITALIQUOTACOFINS,
ITVALORCOFINS,
ITDESCRCOMPLEMENTAR,
ITPRECOTOTAL,
substring(ITSITUACAOTRIBUTARIAESTADUAL,1,1) + case substring(ITSITUACAOTRIBUTARIAESTADUAL,2,2)
when 'B' then '51'
when 'A' then '41'
when '0' then '00'
when '1' then '10'
when '2' then '20'
when '3' then '30'
when '4' then '40'
when '5' then '50'
when '6' then '60'
when '7' then '70'
when '9' then '90'
else '00'
end ITSITTRIBUTARIAESTADUAL,
ITSITTRIBCOFINS,
ITSITTRIBPIS,
ITCONTAANALITICA,
FAINDMOVIMENTO,
ITUNIDADEPADRAO,
ITINDTRIBUTACAOIPI,
ITVALORCONTABILIPI,
ITVALORTOTALDOCUMENTO
from dbo.ztemp_nfsproduto;

  
EXEC SP_OADESTROY @V_OBJ
  
RETURN